# Docker Compose for Sentinel Gate OSS
# Single-service deployment - no external dependencies
#
# Usage:
#   docker compose up -d          # Start service
#   docker compose logs -f        # View logs
#   docker compose down           # Stop service

services:
  # Set correct permissions on named volume for non-root container
  init-permissions:
    image: busybox:1.36-uclibc
    command: ["sh", "-c", "chown -R 65532:65532 /data"]
    volumes:
      - sentinel-gate-data:/data

  sentinel-gate:
    build: .
    depends_on:
      init-permissions:
        condition: service_completed_successfully
    ports:
      - "8080:8080"
    environment:
      - SENTINEL_GATE_DEV_MODE=true
    volumes:
      - sentinel-gate-data:/data
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    restart: unless-stopped

volumes:
  sentinel-gate-data:
